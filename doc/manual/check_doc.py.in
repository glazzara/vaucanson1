#! /usr/bin/env python

import sys
import os
import re

if len(sys.argv) != 2:
  print "usage:", os.path.basename(sys.argv[0]), "path"
  sys.exit(1)

# Check the Vaucanson documentation

filename = sys.argv[1]
version = "@vcsn_version@"

try:
  fh = open(filename, 'r')
except IOError:
  print "No such file"
  sys.exit(2)

lines = fh.read()
lines = lines.split('\n')

sys.stdout.write("Checking file " + filename + " for version " + version + ": ")

# The tag to search
ratexp = re.compile('% @VcsnVersion@')

# The value of the tag
value = '\def\VcsnVersion{' + version + '}'

found = False
for pos, line in enumerate(lines):
  m = ratexp.search(line)
  if m and lines[pos + 1] == value:
    found = True
    break

fh.close()

if found:
  print "OK"
  sys.exit(0)
else:
  print "FAIL"
  sys.exit(1)
