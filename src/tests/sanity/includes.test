#! /bin/sh

# Check that each header is self contained.

: ${VERBOSE=1}

. ../check/defs || exit 1

set -e

rm -f incltest.*

( cd $TOP_SRCDIR/include; find vaucanson -name \*.hh | grep -v '/old/\|/obsolete/' ) | \
while read file; do
   echo "#include <$file>" > incltest.cc
   if $CXX $CXXFLAGS $EXTRA_CXXFLAGS $CPPFLAGS -I$TOP_SRCDIR/include -I$TOP_BUILDDIR/include \
         -c incltest.cc -o incltest.o >/dev/null 2>incltest.err; then
      if [ $VERBOSE -ne 0 ]; then
        echo "TEST: [OK]   $file"
      fi
   else
      if [ $VERBOSE -ne 0 ]; then
        echo "TEST: [FAIL] $file"
      fi
      echo ">>> $file:" >> incltest.fail
      cat incltest.err >> incltest.fail
      rm -f incltest.err
   fi
done

if test -f incltest.fail; then
   echo "Failed files:"
   cat incltest.fail | grep '^>>>'
   exit 1
fi
exit 0
