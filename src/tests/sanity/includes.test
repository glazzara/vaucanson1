#! /bin/sh

# Check that each header is self contained.

: ${VERBOSE=1}

. ../defs || exit 1

set -e

rm -f failures

find $abs_top_srcdir/include/vaucanson -name "${1-*}.hh" \
                    -a ! -path '*/old/*' \
                    -a ! -path '*/obsolete/*' -type f -print |
while read file; do
   name=`expr $file : "$abs_top_srcdir/\(.*\)"`
   echo "#include <$name>" > incltest.cc
   if $CXX $CPPFLAGS $CXXFLAGS -Wno-unused incltest.cc -c -O0 -o /dev/null; then
      echo "TEST: [OK]   $name"
   else
      echo "TEST: [FAIL] $name"
      echo "  $name" >> failures
   fi
done

if test -f failures; then
   echo "Failed files:"
   cat failures
   rm failures
   exit 1;
fi
