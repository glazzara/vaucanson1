#! /bin/sh

# Check that each header is self contained.

: ${VERBOSE=1}

. ../defs || exit 1

set -e

rm -f incltest.*

( cd $TOP_SRCDIR/include; find vaucanson -name \*.hh | grep -v '/old/\|/obsolete/' ) | \
while read file; do
   echo "#include <$file>" > incltest.cc
   if $CXXCOMPILE -c incltest.cc -o incltest.o >/dev/null 2>incltest.err; then
      if [ $VERBOSE -ne 0 ]; then
        echo "TEST: [OK]   $name"
      fi
   else
      if [ $VERBOSE -ne 0 ]; then
        echo "TEST: [FAIL] $name"
      fi
      echo ">>> $name:" >> incltest.fail
      cat incltest.err >> incltest.fail
      rm -f incltest.err
   fi
done

if test -f incltest.fail; then
   echo "Failed files:"
   cat incltest.fail
   rm -f incltest.fail
   exit 1
fi
exit 0
